<link rel="import" href="bower_components/polymer/polymer.html">
<link rel="import" href="bower_components/font-roboto/roboto.html">
<link rel="import" href="bower_components/paper-drawer-panel/paper-drawer-panel.html">
<link rel="import" href="bower_components/paper-header-panel/paper-header-panel.html">
<link rel="import" href="bower_components/paper-toolbar/paper-toolbar.html">
<link rel="import" href="bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="bower_components/paper-fab/paper-fab.html">
<link rel="import" href="bower_components/paper-input/paper-input.html">
<link rel="import" href="bower_components/paper-checkbox/paper-checkbox.html">
<link rel="import" href="bower_components/iron-icons/iron-icons.html">
<link rel="import" href="bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="bower_components/iron-localstorage/iron-localstorage.html">

<dom-module id="codelab-app">
  <link rel="stylesheet" href="styles.css">
  <style>
  [main] span {
    @apply(--layout-flex);
  }
  .item {
    @apply(--layout-center);
    @apply(--layout-horizontal);
  }
  .card {
    @apply(--layout-flex);
  }
  </style>
  <template>
    <paper-drawer-panel responsiveWidth="600px">

      <paper-header-panel drawer>
        <paper-toolbar>
          <span>Menu</span>
        </paper-toolbar>
      </paper-header-panel>

      <paper-header-panel main>
        <paper-toolbar>
          <paper-icon-button icon="menu" paper-drawer-toggle></paper-icon-button>
          <span>My notes</span>
          <paper-icon-button icon="search"></paper-icon-button>
          <paper-icon-button icon="more-vert"></paper-icon-button>
          <paper-fab icon="icons:add" on-click="showNewNoteInput"></paper-fab>
        </paper-toolbar>
        <div class="content">
          <paper-input id="newNoteInput"
                       floatingLabel
                       label="Add a new note"
                       on-change="add"
                       value="{{newNote}}"></paper-input>
          <template is="dom-repeat" items="{{data}}">
            <div class="item">
              <paper-checkbox checked="{{item.done}}" on-change="dataChanged"></paper-checkbox>
              <div class="card">
                <p>{{item.body}}</p>
              </div>
            </div>
          </template>
        </div>
      </paper-header-panel>

    </paper-drawer-panel>
    <iron-localstorage id="storage" name="codelab-app-storage" value="{{data}}"></iron-localstorage>
  </template>
 </dom-module>
<script>
Polymer({
  is: 'codelab-app',
  properties: {
    data: {
      type: Array,
      notify: true,
      observer: 'dataChanged'
    },
    newNote: String
  },
  ready: function() {
    this.$.newNoteInput.style.display = 'none';
  },
  showNewNoteInput: function() {
    this.$.newNoteInput.style.display = 'block';
  },
  add: function() {
    if (this.newNote) {
      //this.data.unshift({body:this.newNote, done:false}); // this does not work
      this.data = (this.data || []).reverse().concat([{
        body: this.newNote,
        done: false
      }]).reverse();
      this.$.newNoteInput.style.display = 'none';
      this.$.newNoteInput.value = null;
    }
  },
  dataChanged: function() {
    this.$.storage.save();
  }
});
</script>
